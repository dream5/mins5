<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mins5.share.business.article.dao.ArticleDao">

	<resultMap type="com.mins5.share.business.article.domain.Article" id="ArticleMap">
		<id property="articleId" column="article_id"/>
		<result property="articleTitle" column="article_title"/>
		<result property="articleContent" column="article_content"/>
		<result property="articleUrl" column="article_url"/>
		<result property="articleFrom" column="article_from"/>
		<result property="articleAuthor" column="article_author"/>
		<result property="status" column="status"/>
		<result property="updateTime" column="update_time"/>
		<result property="createTime" column="create_time"/>
		<result property="isOriginal" column="is_original"/>
		<result property="isValid" column="is_valid"/>
	</resultMap>
	
	<insert id="save" useGeneratedKeys="true" keyProperty="articleId">
		insert into article 
		(
			article_title, article_content, article_url, article_from, article_author,
			status, update_time, create_time, is_original, is_valid
		) 
		values 
		(
			#{articleTitle}, #{articleContent}, #{articleUrl}, #{articleFrom}, #{articleAuthor},
			#{status}, #{updateTime}, #{createTime}, #{isOriginal}, 1
		) 
	</insert>
	
	<!-- 查询随机文章 add by zhanglin 20140314 -->
	<select id="findRandomArticle" parameterType="int" resultMap="ArticleMap">
		select article_title,article_url,create_time from article where status=1 order by rand() limit 0,#{amount}
	</select>
	
	<!-- 查询文章总数 add by zhanglin 20140317 -->
	<select id="findAllArticlesCount"  resultType="int">
		select count(article_id) from article where status=1 
	</select>
	
	<!-- 根据条件查询文章  add by zhanglin 20140318-->
	<select id="findArticleByCondition"  resultMap="ArticleMap">
		select 
			article_id,article_title,article_content,article_from,article_url,article_author, update_time, create_time
        from article where status=1  order by article_id desc limit #{startRow},#{onePageSize} 
	</select>
	
	<!-- 根据分类拼音查询文章总数 add by zhanglin 20140321 -->
	<select id="findArticlesByKindPinyinCount"  resultType="int">
		select count(a.article_id) from article a 
		left join article_kind_rel akr on a.article_id = akr.article_id
		left join  article_kind ak on akr.article_kind_id  = ak.article_kind_id
		where a.status =1 and akr.status=1 and ak.status = 1
		 <if test="kindPinyin != null">  
	       and ak.kind_name =#{kindPinyin}  
	     </if>  
	</select>
	
	<!-- 根据分类拼音查询文章  add by zhanglin 20140321-->
	<select id="findArticlesByKindPinyin"  resultMap="ArticleMap">
		select a.article_id,a.article_title,a.article_content,a.article_from,a.article_url,a.article_author,a.update_time,a.create_time
		from article a 
		left join article_kind_rel akr on a.article_id = akr.article_id
		left join  article_kind ak on akr.article_kind_id  = ak.article_kind_id
		where a.status =1 and akr.status=1 and ak.status = 1
		 <if test="kindPinyin != null">  
	       and ak.kind_name =#{kindPinyin}  
	     </if>  
	     order by a.article_id desc
	     limit #{startRow},#{onePageSize} 
	</select>
	
	
	
</mapper>